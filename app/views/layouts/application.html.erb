<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="autor" content="Helena Moreno Chacón" />
	<title>RouteFinder | <%= controller.controller_name %>:<%= controller.action_name %></title>
	<%= stylesheet_link_tag 'routefinder' %>
	<%= javascript_include_tag :defaults %> 
	<%= ajaxful_rating_style %> 
	<script type="text/javascript" src="/javascripts/jquery.js"></script>

	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true">
	</script>

	<% if @place %>
	<script type="text/javascript">
	function initialize() {
		var geocoder = new google.maps.Geocoder();
		
		<% if @place.coordinates_lat %>
		var latlng = new google.maps.LatLng(<%= @place.coordinates_lat %>, <%= @place.coordinates_long %>); 
		var myOptions = {
			zoom: 16,
			center: latlng,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		<% else %>
		var latlng = new google.maps.LatLng(-34.397, 150.644);
		var myOptions = {
			zoom: 7,
			center: latlng,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		<% end %>
		

		var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		
	}
	</script>

	<script type="text/javascript">
	function codeAddress() {
		var address = document.getElementById("place_direction").value;
		geocoder.geocode( { 'address': address}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				alert("GEOCODING FUNCIONANDO!");
				map.setCenter(results[0].geometry.location);
				var marker = new google.maps.Marker({
					map: map, 
					position: results[0].geometry.location
				});
			} else {
				alert("Geocode was not successful for the following reason: " + status);
			}
		});
	}
	</script>
	<% end %>


</head>

<body onload="initialize()">

	<div id="header">
		<p>Route Finder</p>
	</div>

	<div id="container">

		<div id="navs">

			<% if !current_user %>
			<div id="log_in">
				<%= render :partial => "user_sessions/login", :locals =>{ :user_session => @user_session } %>
				<p id="register_link">
					<%= link_to "Register new user", new_account_path %> 
				</p>
			</div>

			<% else %>
			<div id="user_nav_logged">
				<p>
					Hello <%=h @user.login %>! 
				</p>
				<p>
					<%= link_to "My Account", account_path %> |
					<%= link_to "Logout", user_session_path, :method => :delete, :confirm => "Are you sure you want to logout?" %>
				</p>
			</div>
			<% end %>

			<% if flash[:notice] -%> 			
			<div class="notices">
				<p>
					<%= flash[:notice] %>
				</p>
				<p>
					<%= pluralize User.logged_in.count, "user" %> currently logged in
					<!-- This based on last_request_at, if they were active < 10 minutes they are logged in -->
				</p>
			</div>
			<% end -%> 
		</div>

		<div id="content">
			<%= yield %>
		</div>

	</div>

	<div id="footer">
		<p>RouteFinder 2010.</p>
		<p>Helena Moreno Chacón</p>
	</div>

</body>
</html>
